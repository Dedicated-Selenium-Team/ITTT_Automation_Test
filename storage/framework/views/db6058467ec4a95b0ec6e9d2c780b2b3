<title>ITTT | Projects</title>

<?php $__env->startSection('content'); ?>

<!-- <div class="bread-crumb">
  <div> 
    <a class="current-page">projects</a>
  </div>
</div> -->

<!-- All Projects Container data starts here -->
<div class="wrap-content cf">

  <!-- Add New Project Button Starts Here  -->
  <nav class = "addProjectNav container-heading cf" >
    <ul>
      <?php
      $role_id = Session::get('user')[0]['role_id'];
      if ($role_id == 1) {?>
       <li class="myproject cf">
         <a href="#FIXME" title="Add New Project" class="addProject" data-toggle="modal" data-target="#create-project">Add New Project</a>
       </li>
       <?php }if ($role_id == 1 || $role_id == 2) {?>
         <li>
           <a href="/myself" title="Add Myself To A Project" class="assign-project">Add myself to a project</a>
         </li>
         <?php }?>
       </ul>
     </nav>
     <!-- Add New Project Button Ends Here  -->

     <!-- Add New Project Modal Starts Here-->
     <div class="modal fade modal-error-off" id="create-project" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content Starts Here-->
        <div class="modal-content">

          <!-- Modal Header Starts Here -->
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h1 class="modal-title">Create New Project</h1>
          </div>
          <!-- Modal Header Ends Here -->

          <!-- Modal Body Starts Here -->
          <div class="modal-body">

            <?php echo Form::open(array('id' => 'add-project', 'method' => 'post')); ?>


            <div class="form-group cf">
              <?php echo Html::decode(Form::label('project_name','Project Name<span class="required">*</span>:')); ?>

              <?php echo Form::text('project_name', Input::old('project_name'), array('class' => '','placeholder' =>'Project name')); ?>

              <p class="error"></p>
            </div>

            <div class="form-group cf">
              <?php echo Html::decode(Form::label('project_code','Project Code:')); ?>

              <?php echo Form::text('project_code', Input::old('project_name'), array('placeholder' =>'Project code')); ?>

              <p class="error"></p>
            </div>

            <div class="form-group cf">
              <?php echo Html::decode(Form::label('client_name','Client Name<span class="required">*</span>:')); ?>

              <?php echo Form::text('client_name', Input::old('client_name'), array('placeholder' =>'Client name')); ?>

              <p class="error"></p>
            </div>

          </div>
          <!-- Modal Body Ends Here -->

          <!-- Modal Footer Starts Here -->
          <div class="modal-footer">
            <div class="save-project">
              <?php echo Form::submit('Submit'); ?>

              <?php /* <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> */ ?>
            </div>
          </div>
          <!-- Modal Footer Ends Here -->

        </div>
        <!-- Modal content Starts Here-->

        <?php echo Form::close(); ?>


      </div>
    </div>
    <!-- Add New Project Modal Ends Here-->

    <!-- Edit Project Modal starts Here-->
    <div class="modal fade modal-error-off" id="edit-project" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content Starts Here-->
        <div class="modal-content">

          <!-- Modal Header Starts Here -->
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h1 class="modal-title">Edit Project</h1>
          </div>
          <!-- Modal Header Ends Here -->

          <!-- Modal Body Starts Here -->
          <div class="modal-body">

            <?php echo Form::open(array('id' => 'edit-project-data', 'method' => 'post')); ?>


            <?php echo Form::hidden('project_id', '',array('id'=>'edit_project_id')); ?>

            
            <div class="form-group cf">
              <?php echo Html::decode(Form::label('edit_project_name','Project Name<span class="required">*</span>:')); ?>

              <?php echo Form::text('edit_project_name','', array('class' => '','placeholder' =>'Project name')); ?>

              <p class="error"></p>
            </div>

            <div class="form-group cf">
              <?php echo Html::decode(Form::label('edit_client_name','Client Name<span class="required">*</span>:')); ?>

              <?php echo Form::text('edit_client_name','', array('placeholder' =>'Client name')); ?>

              <p class="error"></p>
            </div>

          </div>
          <!-- Modal Body Ends Here -->

          <!-- Modal Footer Starts Here -->
          <div class="modal-footer">
            <div class="save-project">
              <?php echo Form::submit('Update'); ?>

              <?php /* <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> */ ?>
            </div>
          </div>
          <!-- Modal Footer Ends Here -->

        </div>
        <!-- Modal content Starts Here-->

        <?php echo Form::close(); ?>


      </div>
    </div>
    <!-- Edit Project Modal Ends Here-->

    <!-- All Projects list starts here -->
    <?php $count = count($myproject)+count($projects);?>
    <div class="timesheet-content all-projects-content">
      <div class="total-projects">
        <h2 class="project-count">Total Number of Projects: <span class="italic"><?php echo e($count); ?></span> </h2>
        <h2 class="project-count">total Number of Projects assigned: <span class="italic"><?php echo e(count($myproject)); ?></span> </h2>
      </div>
      <div class="all-prj connectedSortable" id="tabs">
        <ul>
          <li><a href="#tabs-1">All Projects</a></li>
          <li><a href="#tabs-2">Estimates</a></li>
          <li><a href="#tabs-3">Live-Projects</a></li>
          <li><a href="#tabs-4">Live-Ongoing</a></li>
          <li><a href="#tabs-5">Completed</a></li>
        </ul>
        <div id="tabs-1">
          <?php foreach( $myproject as $my_allproject  ): ?>
          <div class="wrap-project assigned-projects cf">

            <?php if ($role_id == 1) {?>
              <div class="actions cf">
                <!--<span>Action</span> -->
                <div>
                  <a href="#" title="Edit" class="edit-action" data-id="<?php echo e($my_allproject->project_id); ?>">edit</a>

                </div>
              </div>
              <?php } ?>
              <a href="/project-designation/<?php echo e($my_allproject->project_id); ?>" class="count_name">
                <!-- <div class="all-project-details"> -->
                <span class="pro_name" title="Project Name: <?php echo e($my_allproject->project_name); ?>"><?php echo e($my_allproject->project_name); ?></span>
                <span class="pro_client" title="Client Name: <?php echo e($my_allproject->client_name); ?>"><?php echo e($my_allproject->client_name); ?></span>
                <span class="pro_code" title="Project ID: <?php echo e($my_allproject->project_id); ?>">ID: <?php echo e($my_allproject->project_id); ?></span>
                <span class="pro_desig" title="Designation: <?php echo e($my_allproject->designation_name); ?>"><?php echo e($my_allproject->designation_name); ?></span>
                <!-- </div> -->
              </a>
              <div class="estimate-plan">
                <span class="estimate-span">
                  <a href="/store_project/estimate/<?php echo e($my_allproject->project_id); ?>" title="Estimation" class="detail-plan">Estimation</a>
                </span>
                <span class="planning-span">
                  <a href="/store_project/planning/<?php echo e($my_allproject->project_id); ?>" title="Planning" class="detail-plan">Planning</a>
                </span>
              </div>
            </div>
            <?php endforeach; ?>

            <?php foreach( $projects as $project_detail ): ?>
            <?php if (count($myproject) == 0) {?>
             <div class="wrap-project cf">
               <?php } else {?>
                 <div class="wrap-project unassigned-projects cf">
                  <?php }?>

                  <?php if ($role_id == 1) {?>
                    <div class="actions cf">
                      <!--<span>Action</span> -->
                      <div>
                        <a href="#" title="Edit" class="edit-action" data-id="<?php echo e($project_detail->project_id); ?>">edit</a>
                      </div>
                    </div>
                    <?php } ?>
                    <a href="/project-designation/<?php echo e($project_detail->project_id); ?>" class="count_name">
                      <!-- <div class="all-project-details"> -->
                      <span class="pro_name" title="Project Name: <?php echo e($project_detail->project_name); ?>"><?php echo e($project_detail->project_name); ?></span>
                      <span class="pro_client" title="Client Name: <?php echo e($project_detail->client_name); ?>"><?php echo e($project_detail->client_name); ?></span>
                      <span class="pro_code" title="Project ID: <?php echo e($project_detail->project_id); ?>">ID: <?php echo e($project_detail->project_id); ?></span>
                      <!-- </div> -->
                    </a>
                    <div class="estimate-plan">
                      <span class="estimate-span">
                        <a href="/store_project/estimate/<?php echo e($project_detail->project_id); ?>" title="Estimation" class="detail-plan">Estimation</a>
                      </span>
                      <span class="planning-span">
                        <a href="/store_project/planning/<?php echo e($project_detail->project_id); ?>" title="Planning" class="detail-plan">Planning</a>
                      </span>
                    </div>
                  </div>
                  <?php endforeach; ?>
                </div>

                <div id="tabs-2">
                 <?php foreach($estimates_project as $my_allproject  ): ?>
                 <?php if($my_allproject->is_myproject == "Yes"): ?>
                 <div class="wrap-project assigned-projects cf">
                   <?php else: ?>
                   <div class="wrap-project cf">
                    <?php endif; ?>

                    <?php if ($role_id == 1) {?>
                      <div class="actions cf">
                        <!--<span>Action</span> -->
                        <div>
                          <a href="#" title="Edit" class="edit-action" data-id="<?php echo e($my_allproject->project_id); ?>">edit</a>
                          <select name="ddlProjectStatus" id="pStatus" class="proj_status" title="Move To">
                            <option value="1">Please Select</option>
                            <option value="2_<?php echo e($my_allproject->project_id); ?>">Live-Projects</option>
                            <option value="3_<?php echo e($my_allproject->project_id); ?>">Live-Ongoing</option>
                            <option value="4_<?php echo e($my_allproject->project_id); ?>">Completed</option>
                          </select>
                        </div>
                      </div>
                      <?php } ?>
                      <a href="/project-designation/<?php echo e($my_allproject->project_id); ?>" class="count_name">
                        <!-- <div class="all-project-details"> -->
                        <span class="pro_name" title="Project Name: <?php echo e($my_allproject->project_name); ?>"><?php echo e($my_allproject->project_name); ?></span>
                        <span class="pro_client" title="Client Name: <?php echo e($my_allproject->client_name); ?>"><?php echo e($my_allproject->client_name); ?></span>
                        <span class="pro_code" title="Project ID: <?php echo e($my_allproject->project_id); ?>">ID: <?php echo e($my_allproject->project_id); ?></span>
                        <span class="pro_desig" title="Designation: <?php echo e($my_allproject->designation_name); ?>"><?php echo e($my_allproject->designation_name); ?></span>
                        <!-- </div> -->
                      </a>

                      <div class="estimate-plan">
                        <span class="estimate-span">
                          <a href="/store_project/estimate/<?php echo e($my_allproject->project_id); ?>" title="Estimation" class="detail-plan">Estimation</a>
                        </span>
                        <span class="planning-span">
                          <a href="/store_project/planning/<?php echo e($my_allproject->project_id); ?>" title="Planning" class="detail-plan">Planning</a>
                        </span>
                      </div>
                    </div>
                    <?php endforeach; ?>
                  </div>
                  <div id="tabs-3">
                   <?php foreach( $live_project as $my_allproject  ): ?>
                   <?php if($my_allproject->is_myproject == "Yes"): ?>
                   <div class="wrap-project assigned-projects cf">
                     <?php else: ?>
                     <div class="wrap-project cf">
                      <?php endif; ?>

                      <?php if ($role_id == 1) {?>
                        <div class="actions cf">
                          <!--<span>Action</span> -->
                          <div>
                            <a href="#" title="Edit" class="edit-action" data-id="<?php echo e($my_allproject->project_id); ?>">edit</a>
                            <select name="ddlProjectStatus" id="pStatus" class="proj_status" title="Move To">
                              <option value="1">Please Select</option>
                              <option value="3_<?php echo e($my_allproject->project_id); ?>">Live-Ongoing</option>
                              <option value="4_<?php echo e($my_allproject->project_id); ?>">Completed</option>
                            </select>
                          </div>
                        </div>
                        <?php } ?>
                        <a href="/project-designation/<?php echo e($my_allproject->project_id); ?>" class="count_name">
                          <!-- <div class="all-project-details"> -->
                          <span class="pro_name" title="Project Name: <?php echo e($my_allproject->project_name); ?>"><?php echo e($my_allproject->project_name); ?></span>
                          <span class="pro_client" title="Client Name: <?php echo e($my_allproject->client_name); ?>"><?php echo e($my_allproject->client_name); ?></span>
                          <span class="pro_code" title="Project ID: <?php echo e($my_allproject->project_id); ?>">ID: <?php echo e($my_allproject->project_id); ?></span>
                          <span class="pro_desig" title="Designation: <?php echo e($my_allproject->designation_name); ?>"><?php echo e($my_allproject->designation_name); ?></span>
                          <!-- </div> -->
                        </a>

                        <div class="estimate-plan">
                          <span class="estimate-span">
                            <a href="/store_project/estimate/<?php echo e($my_allproject->project_id); ?>" title="Estimation" class="detail-plan">Estimation</a>
                          </span>
                          <span class="planning-span">
                            <a href="/store_project/planning/<?php echo e($my_allproject->project_id); ?>" title="Planning" class="detail-plan">Planning</a>
                          </span>
                        </div>
                      </div>
                      <?php endforeach; ?>

                    </div>
                    <div id="tabs-4">
                     <?php foreach($live_ongoing_project as $my_allproject  ): ?>
                     <?php if($my_allproject->is_myproject == "Yes"): ?>
                     <div class="wrap-project assigned-projects cf">
                       <?php else: ?>
                       <div class="wrap-project cf">
                        <?php endif; ?>

                        <?php if ($role_id == 1) {?>
                          <div class="actions cf">
                            <!--<span>Action</span> -->
                            <div>
                              <a href="#" title="Edit" class="edit-action" data-id="<?php echo e($my_allproject->project_id); ?>">edit</a>
                              <select name="ddlProjectStatus" id="pStatus" class="proj_status" title="Move To">
                                <option value="1">Please Select</option>
                                <option value="4_<?php echo e($my_allproject->project_id); ?>">Completed</option>
                              </select>
                            </div>
                          </div>
                          <?php } ?>
                          <a href="/project-designation/<?php echo e($my_allproject->project_id); ?>" class="count_name">
                            <!-- <div class="all-project-details"> -->
                            <span class="pro_name" title="Project Name: <?php echo e($my_allproject->project_name); ?>"><?php echo e($my_allproject->project_name); ?></span>
                            <span class="pro_client" title="Client Name: <?php echo e($my_allproject->client_name); ?>"><?php echo e($my_allproject->client_name); ?></span>
                            <span class="pro_code" title="Project ID: <?php echo e($my_allproject->project_id); ?>">ID: <?php echo e($my_allproject->project_id); ?></span>
                            <span class="pro_desig" title="Designation: <?php echo e($my_allproject->designation_name); ?>"><?php echo e($my_allproject->designation_name); ?></span>
                            <!-- </div> -->
                          </a>

                          <div class="estimate-plan">
                            <span class="estimate-span">
                              <a href="/store_project/estimate/<?php echo e($my_allproject->project_id); ?>" title="Estimation" class="detail-plan">Estimation</a>
                            </span>
                            <span class="planning-span">
                              <a href="/store_project/planning/<?php echo e($my_allproject->project_id); ?>" title="Planning" class="detail-plan">Planning</a>
                            </span>
                          </div>
                        </div>
                        <?php endforeach; ?>
                      </div>
                      <div id="tabs-5">
                       <?php foreach( $completed_project as $my_allproject  ): ?>
                       <?php if($my_allproject->is_myproject == "Yes"): ?>
                       <div class="wrap-project assigned-projects cf">
                         <?php else: ?>
                         <div class="wrap-project cf">
                          <?php endif; ?>

                          <?php if ($role_id == 1) {?>
                            <div class="actions cf">
                              <!--<span>Action</span> -->
                              <div>
                                <a href="#" title="Edit" class="edit-action" data-id="<?php echo e($my_allproject->project_id); ?>">edit</a>
                              </div>
                            </div>
                            <?php } ?>
                            <a href="/project-designation/<?php echo e($my_allproject->project_id); ?>" class="count_name">
                              <!-- <div class="all-project-details"> -->
                              <span class="pro_name" title="Project Name: <?php echo e($my_allproject->project_name); ?>"><?php echo e($my_allproject->project_name); ?></span>
                              <span class="pro_client" title="Client Name: <?php echo e($my_allproject->client_name); ?>"><?php echo e($my_allproject->client_name); ?></span>
                              <span class="pro_code" title="Project ID: <?php echo e($my_allproject->project_id); ?>">ID: <?php echo e($my_allproject->project_id); ?></span>
                              <span class="pro_desig" title="Designation: <?php echo e($my_allproject->designation_name); ?>"><?php echo e($my_allproject->designation_name); ?></span>
                              <!-- </div> -->
                            </a>
                            <div class="estimate-plan">
                              <span class="estimate-span">
                                <a href="/store_project/estimate/<?php echo e($my_allproject->project_id); ?>" title="Estimation" class="detail-plan">Estimation</a>
                              </span>
                              <span class="planning-span">
                                <a href="/store_project/planning/<?php echo e($my_allproject->project_id); ?>" title="Planning" class="detail-plan">Planning</a>
                              </span>
                            </div>
                          </div>
                          <?php endforeach; ?>
                        </div>

                      </div>
                    </div>

                    <!-- All Projects list ends here -->
                    <script>
                     $.ajaxSetup({
headers:
    {
        'X-CSRF-Token': $('input[name="_token"]').val()
    }
                    });
                     $(".proj_status").change(function(){
                      var status=($(this).val()).split("_");
                      var project_status=status[0];
                      var project_id=status[1];
                      if(project_status==1)
                        alert("please select project status");
                      else
                      {
                        $.ajax({
                         type: 'POST',
                         url: 'change_project_status',
                         data: {'project_id':project_id,'project_status':project_status},
                         success:function(data)
                         {
                          if(data.success==1)
                            location.reload();
                          else
                            alert("Something went wrong.Please try again later.");
                        }

                      });
                      }
                    });

                $('#edit-project').on('submit',function(e) {
                  e.preventDefault();
                  var project_id=$("#edit_project_id").val();
                  var project_name=$("#edit_project_name").val();
                  var client_name=$("#edit_client_name").val();
                  $.ajax({
                    type:'POST',
                    url:'edit_project_info',
                    data: {'project_name':project_name,'client_name':client_name,'project_id':project_id},
                    
                    success:function(data)
                    { 
			if(data.success==1)
			      location.reload();
			else
			alert("Something went wrong.Please try again later");
                    }
                  });

                });

                /****  Edit functionality ****/
                $('.all-prj').delegate('.edit-action', 'click', function(e){
		  e.preventDefault();
                  var value = $(this).data('id');
                  var url = '<?php echo e(URL::to('edit-project')); ?>';
                  $.ajax({
                    type : 'get',
                    url : url,
                    data : {'id':value},
                    headers: {'id': value},
                    success : function(data) {
                      $('#edit_project_name').val(data.project_name);
                      $('#edit_client_name').val(data.client_name);
                      $('#edit_project_id').val(data.project_id);
                      $('#edit-project').modal('show');
                    }
                  });
                });
              </script>
            </div>
            <!-- All Projects Container data ends here -->

            <?php $__env->stopSection(); ?>


<?php echo $__env->make('master', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>